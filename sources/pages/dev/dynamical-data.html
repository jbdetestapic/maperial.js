<html>

<head>
<title>Maperial 2.0 - Dynamical data</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
<link href="http://192.168.1.19/p/maperial/web/static/css/maperial.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div id="heatmap" class="fullscreen-map"></div>
	<div class="hud">
	   <input type="range" class="slider" min="1" max="1000" step="1">
	</div>
</body>

<script type="text/javascript" src="//192.168.1.19/p/maperial/web/static/js/maperial.js"></script>

<script type="text/javascript">
    (function() {

        //-------------------------------------------------------//
        // data demo
        //-------------------------------------------------------//

        var generateBatch = function() {

            var batch = [];

            for (var i = 0; i < 1000; i++) {
                var point = {
                    lat : 50.007874 + (Math.floor(Math.random() * (1000))) / 1000,
                    lon : 2.080601999999999 + (Math
                            .floor(Math.random() * (1200))) / 600,
                    data : {
                        brasserie : "Abbaye de St Landelin"
                    }
                };

                batch.push(point);
            }

            return batch;
        }

        //-------------------------------------------------------//

        var batches = [];
        for (var i = 0; i < 1000; i++)
            batches.push(generateBatch());

        //-------------------------------------------------------//

        var loadBatch = function(batch, dynamicalData) {
            dynamicalData.removeAll();
            batch.forEach(function(point) {
                dynamicalData.addPoint(point.lat, point.lon, point.data);
            })
        }

        //-------------------------------------------------------//
        // Maperial
        //-------------------------------------------------------//

        var maperial = new Maperial();

        //-----------------------------------------------//

        var map = maperial.addView({
            container       : "heatmap",
            defaultZoom     : 9,
            latitude        : 50.516584,
            longitude       : 3.186998
        });

        //-----------------------------------------------//
        //Layer Images

        map.addImageLayer(Source.IMAGES_OCM_TRANSPORT);

        //-----------------------------------------------//
        //Layer Vectorial Data 

        var brasseries = new DynamicalData();

        var options = {
            style : {
                symbol : "symbols/blue.pointer.png"
            }
        };

        map.addDynamicalLayer(brasseries, options);

        //-------------------------------------------------------//
        // demo hud
        //-------------------------------------------------------//

        $(".slider").slider({
            orientation : "horizontal",
            min : 0,
            max : 1000,
            step : 1,
            value : 0,
            slide : function() {
                console.log("slide")
                return function(event, ui) {
                    var batchNum = ui.value - 1
                    console.log("batchNum")
                    loadBatch(batches[batchNum], brasseries);
                }
            }()
        });

        loadBatch(batches[0], brasseries);

    })();
</script>


</html>


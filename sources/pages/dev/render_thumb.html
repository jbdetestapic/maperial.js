<html>

<head>
   <title>Thumb</title>
   <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
   <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script type="text/javascript">

function getScript(src) {
   document.write('<' + 'script src="' + src + '"' + ' type="text/javascript"><' + '/script>');
}


getScript("js/extensions/maperial/libs/gl-matrix-min.js");
getScript("js/extensions/maperial/libs/coordinate-system.js");
getScript("js/extensions/maperial/rendering/tile-renderer.js");
getScript("js/extensions/maperial/rendering/render-text.js");
getScript("js/extensions/maperial/rendering/render-line.js");

function InitMapsViewer() {

   var conf    = null;
   var confUrl = "thumbsdata/conf.json";
   //var styleUrl= "http://map.x-ray.fr/style/style.jsonz";
   
   $.ajax({
      type     : "GET",
      url       : confUrl,
      async     : false,
      dataType  : 'json',
      success   : function (response) {
         conf = response;
      }
   });
   
   var url        = conf["url"];
   var z          = conf["z"];
   var styleUrl   = conf["styleUrl"];
   var style      = null;
   
   $.ajax({
      type        : "GET",
      url         : styleUrl ,
      async       : false,
      dataType    : 'json',
      success     : function (data) {
         style = data;
      }
   });
   
   var toRender= null;
   $.ajax({
      type     : "GET",
      url      : url,
      dataType : "json",
      async    : false,      
      success  : function(data, textStatus, jqXHR) {
         toRender = data
      },
      error : function(jqXHR, textStatus, errorThrown) {
		console.log ("Load Error");
		console.log (textStatus)
      }
   })
   
   if (toRender ) {
      var canvas     = document.getElementById("thumb");
      var tile       = new Object ( );
      tile.z         = z;
      tile.cnv       = null;
      tile.data      = toRender;
      tile.cnv       = canvas
      tile.cnv.height= toRender["h"];
      tile.cnv.width = toRender["w"];

      tile.ctx=tile.cnv.getContext("2d");
      ExtendCanvasContext ( tile.ctx );
      tile.ctx.globalCompositeOperation="source-over";
      tile.ctx.beginPath();
      tile.ctx.closePath();
      TileRenderer.RenderLayers (null, null ,tile.ctx , tile.data , tile.z,style ) ;
   }
}

</script>
</head>

<body id="body" onload="InitMapsViewer();" style="margin:0px;padding:0px;" >
   <canvas id="thumb" style="border: none;"></canvas>
</body>

</html>

